# BLUEPRINT: isomon 27001 v0 - GENERATED BY IEEE-GEN

## I. PROTOCOLO DE IDENTIDAD Y GOBERNANZA (IEEE 1058)

**Metadata**:
- **UUID**: 550e8400-e29b-41d4-a716-446655440000
- **Standard**: IEEE 12207:2017
- **Criticality/Lvl**: High/Mission-Critical

**Matriz RACI**:
- **Responsable**: Equipo de Desarrollo (Antigravity Agent)
- **Aprobador**: Abastible (Stakeholders)
- **Consultado**: Marcos Alarcón
- **Informado**: Usuarios Finales (Contratistas)

**Restricción de Base de Datos**: MySQL (InnoDB Engine)
**Restricción**: Todos los módulos técnicos tienen un responsable asignado en la documentación.

## II. EL "JSON DE LA VERDAD" (ESTRUCTURA DE DATOS MAESTRA)

```json
{
  "system_blueprint": {
    "compliance": "IEEE 29148 / IEEE 1016",
    "requirements_catalog": [
      {
        "id": "REQ-001",
        "type": "Functional",
        "statement": "El sistema debe proporcionar un Dashboard de indicadores clave de desempeño (KPIs) segmentado por rol.",
        "priority": "1",
        "verification_method": "Demonstration"
      },
      {
        "id": "REQ-002",
        "type": "Functional",
        "statement": "El sistema debe permitir el ciclo completo de gestión de registros mensuales (creación, edición, auditoría, cierre).",
        "priority": "1",
        "verification_method": "Test"
      },
      {
        "id": "REQ-003",
        "type": "Security",
        "statement": "El acceso a los datos debe estar restringido mediante una matriz de control de acceso basada en roles (RBAC) granular.",
        "priority": "1",
        "verification_method": "Analysis"
      },
      {
        "id": "REQ-004",
        "type": "Functional",
        "statement": "El sistema debe manejar un flujo de re-apertura de registros auditados mediante solicitudes y aprobaciones.",
        "priority": "2",
        "verification_method": "Test"
      },
      {
        "id": "REQ-005",
        "type": "Non-Functional",
        "statement": "Toda acción crítica sobre un registro debe quedar almacenada en logs de auditoría inmutables.",
        "priority": "2",
        "verification_method": "Inspection"
      }
    ],
    "agile_layer": {
      "user_stories": [
        {
          "id": "US-001",
          "parent_req_id": "REQ-001",
          "role": "Como Administrador",
          "action": "Quiero ver un dashboard con el cumplimiento general y alertas",
          "benefit": "Para tomar decisiones basadas en datos en tiempo real",
          "acceptance_criteria": ["Debe mostrar % cumplimiento general", "Debe listar alertas de contratistas bajos"],
          "security_tag": "Internal"
        },
        {
          "id": "US-002",
          "parent_req_id": "REQ-002",
          "role": "Como Contratista",
          "action": "Quiero ingresar mi registro mensual y subir evidencias",
          "benefit": "Para cumplir con la normativa de la empresa",
          "acceptance_criteria": ["Validar campos obligatorios", "Permitir carga de archivos (evidencias)", "Bloquear edición si ya está enviado"],
          "security_tag": "Internal"
        },
        {
          "id": "US-003",
          "parent_req_id": "REQ-002",
          "role": "Como Auditor",
          "action": "Quiero auditar un registro y marcar hallazgos",
          "benefit": "Para verificar el cumplimiento normativo",
          "acceptance_criteria": ["Permitir aprobar/rechazar items", "Permitir agregar comentarios", "Permitir levantar hallazgos"],
          "security_tag": "Internal"
        },
        {
          "id": "US-004",
          "parent_req_id": "REQ-004",
          "role": "Como Contratista",
          "action": "Quiero solicitar la reapertura de un registro cerrado",
          "benefit": "Para subsanar observaciones encontradas",
          "acceptance_criteria": ["Debe exigir motivo", "Debe notificar al administrador"],
          "security_tag": "Internal"
        }
      ]
    },
    "persistence_architecture": {
      "database_engine": "MySQL_8.0+_InnoDB",
      "sql_mode": "STRICT_TRANS_TABLES",
      "seeding_strategy": "Hierarchical_Dependency_Injection",
      "entities": [
        {
          "table_name": "roles",
          "execution_order_index": 0,
          "depends_on": [],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "name", "type": "VARCHAR(255)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "guard_name", "type": "VARCHAR(255)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "tipos_contratista",
          "execution_order_index": 0,
          "depends_on": [],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "nombre", "type": "VARCHAR(255)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "descripcion", "type": "TEXT", "is_pii": false, "constraints": [], "encryption": "NONE" },
            { "name": "activo", "type": "TINYINT(1)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "dependencias",
          "execution_order_index": 0,
          "depends_on": [],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "nombre", "type": "VARCHAR(255)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "activo", "type": "TINYINT(1)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "programas",
          "execution_order_index": 0,
          "depends_on": [],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "nombre", "type": "VARCHAR(255)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "descripcion", "type": "TEXT", "is_pii": false, "constraints": [], "encryption": "NONE" },
            { "name": "activo", "type": "TINYINT(1)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "configuraciones",
          "execution_order_index": 0,
          "depends_on": [],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "key", "type": "VARCHAR(255)", "is_pii": false, "constraints": ["NN", "UQ"], "encryption": "NONE" },
            { "name": "value", "type": "TEXT", "is_pii": false, "constraints": [], "encryption": "NONE" },
            { "name": "description", "type": "VARCHAR(500)", "is_pii": false, "constraints": [], "encryption": "NONE" },
            { "name": "type", "type": "VARCHAR(50)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "elementos",
          "execution_order_index": 1,
          "depends_on": ["programas"],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "programa_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK"], "encryption": "NONE" },
            { "name": "numero", "type": "VARCHAR(20)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "nombre", "type": "VARCHAR(255)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "orden", "type": "INT", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "activo", "type": "TINYINT(1)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "users",
          "execution_order_index": 1,
          "depends_on": ["tipos_contratista", "dependencias"],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "name", "type": "VARCHAR(255)", "is_pii": true, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "email", "type": "VARCHAR(255)", "is_pii": true, "constraints": ["NN", "UQ"], "encryption": "NONE" },
            { "name": "password", "type": "VARCHAR(255)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "role", "type": "VARCHAR(50)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "parent_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK"], "encryption": "NONE" },
            { "name": "tipo_contratista_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK"], "encryption": "NONE" },
            { "name": "dependencia_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK"], "encryption": "NONE" },
            { "name": "eecc_nombre", "type": "VARCHAR(255)", "is_pii": false, "constraints": [], "encryption": "NONE" },
            { "name": "rut", "type": "VARCHAR(20)", "is_pii": true, "constraints": [], "encryption": "AES_ENCRYPT" },
            { "name": "telefono", "type": "VARCHAR(50)", "is_pii": true, "constraints": [], "encryption": "NONE" },
            { "name": "activo", "type": "TINYINT(1)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "actividades",
          "execution_order_index": 2,
          "depends_on": ["elementos"],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "elemento_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "codigo", "type": "VARCHAR(20)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "descripcion", "type": "TEXT", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "criterios", "type": "TEXT", "is_pii": false, "constraints": [], "encryption": "NONE" },
            { "name": "frecuencia", "type": "ENUM('mensual','trimestral','semestral','anual','cuando_aplique')", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "requiere_evidencia", "type": "TINYINT(1)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "activo", "type": "TINYINT(1)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "privilegios",
          "execution_order_index": 2,
          "depends_on": ["roles"],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "role_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "ref_modulo", "type": "VARCHAR(255)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "read", "type": "TINYINT(1)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "write", "type": "TINYINT(1)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "excec", "type": "TINYINT(1)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "contratista_asignaciones",
          "execution_order_index": 2,
          "depends_on": ["users", "tipos_contratista", "dependencias"],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "user_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "tipo_contratista_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "dependencia_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "administrador_contrato_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK"], "encryption": "NONE" },
            { "name": "periodo_inicio", "type": "DATE", "is_pii": false, "constraints": [], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "registros",
          "execution_order_index": 3,
          "depends_on": ["users", "contratista_asignaciones"],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "user_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "contratista_asignacion_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK"], "encryption": "NONE" },
            { "name": "periodo", "type": "DATE", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "estado_auditoria", "type": "ENUM('pendiente','auditando','auditada_terreno','auditada_sistema','reabierto')", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "porcentaje_cumplimiento", "type": "DECIMAL(5,2)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "auditor_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "compromisos",
          "execution_order_index": 3,
          "depends_on": ["contratista_asignaciones"],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "contratista_asignacion_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "descripcion_compromiso", "type": "TEXT", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "fecha_cumplimiento", "type": "DATE", "is_pii": false, "constraints": [], "encryption": "NONE" },
            { "name": "estado_cumplimiento", "type": "ENUM('comprometido','cumple','no cumple')", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "registro_actividades",
          "execution_order_index": 4,
          "depends_on": ["registros", "actividades"],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "registro_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "actividad_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "cumple", "type": "TINYINT(1)", "is_pii": false, "constraints": [], "encryption": "NONE" },
            { "name": "cumple_auditor", "type": "TINYINT(1)", "is_pii": false, "constraints": [], "encryption": "NONE" },
            { "name": "responsable", "type": "VARCHAR(255)", "is_pii": false, "constraints": [], "encryption": "NONE" },
            { "name": "observacion_auditor", "type": "TEXT", "is_pii": false, "constraints": [], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "registro_logs",
          "execution_order_index": 4,
          "depends_on": ["registros", "users"],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "registro_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "user_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK"], "encryption": "NONE" },
            { "name": "accion", "type": "VARCHAR(50)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "datos_anteriores", "type": "JSON", "is_pii": false, "constraints": [], "encryption": "NONE" },
            { "name": "datos_nuevos", "type": "JSON", "is_pii": false, "constraints": [], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "solicitudes_reapertura",
          "execution_order_index": 4,
          "depends_on": ["registros", "users"],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "registro_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "solicitante_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "motivo", "type": "TEXT", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "estado", "type": "ENUM('pendiente','aprobada','rechazada')", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "aprobador_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "hallazgos",
          "execution_order_index": 4,
          "depends_on": ["registros", "registro_actividades", "users"],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "registro_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "registro_actividad_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK"], "encryption": "NONE" },
            { "name": "auditor_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "descripcion", "type": "TEXT", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "estado", "type": "ENUM('abierto','cerrado')", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "auditoria_comentarios",
          "execution_order_index": 4,
          "depends_on": ["registros", "users"],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "registro_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "user_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "comentario", "type": "TEXT", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" }
          ]
        },
        {
          "table_name": "evidencias",
          "execution_order_index": 5,
          "depends_on": ["registro_actividades"],
          "schema": [
            { "name": "id", "type": "BIGINT UNSIGNED AUTO_INCREMENT", "is_pii": false, "constraints": ["PK", "NN"], "encryption": "NONE" },
            { "name": "registro_actividad_id", "type": "BIGINT UNSIGNED", "is_pii": false, "constraints": ["FK", "NN"], "encryption": "NONE" },
            { "name": "nombre_archivo", "type": "VARCHAR(255)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "ruta_archivo", "type": "VARCHAR(500)", "is_pii": false, "constraints": ["NN"], "encryption": "NONE" },
            { "name": "tamaÃ±o", "type": "INT UNSIGNED", "is_pii": false, "constraints": [], "encryption": "NONE" }
          ]
        }
      ]
    },
    "security_hardening": {
      "standard": "IEEE 7000 (Privacy by Design)",
      "auth_policy": "JWT_RS256",
      "encryption_targets": ["users.rut"],
      "audit_logic": "Global_Event_Sourcing"
    }
  }
}
```

## III. REGLAS DE ORO Y CONFIGURACIÓN CRÍTICA (GUARDRAILS)

**Ley de Precedencia (Seeders)**: En el JSON, ninguna entidad en `persistence_architecture` puede tener un ejecución_order_index menor que sus tablas listadas en `depends_on`.

**Configuración de Integridad MySQL**:
- **Motor InnoDB Obligatorio**: Se prohíbe cualquier otro motor (como MyISAM). Las Foreign Keys deben estar activas (FOREIGN_KEY_CHECKS=1).
- **Strict Mode**: Es obligatoria la activación de `STRICT_TRANS_TABLES` para evitar truncamiento de datos.

**Ley de Blindaje (IEEE 7000 / PII)**:
- Hashing (bcrypt) en passwords.
- `users.rut` marcado para encriptación `AES_ENCRYPT` en capa de datos.

**Ley de Atomicidad**: Todas las transacciones mutantes deben estar en bloques `START TRANSACTION`.

## IV. VISTAS DE ARQUITECTURA (IEEE 1016)

**Vista de Datos (ERD Conceptual)**:
- `users` (1) <-- (N) `registros`
- `registros` (1) <-- (N) `registro_actividades`
- `registro_actividades` (1) <-- (N) `evidencias`
- `programas` (1) <-- (N) `elementos` <-- (N) `actividades`

**Vista de Integración**:
- API REST Stateless.
- `POST /login`: Retorna JWT.
- `GET /me`: Contexto del usuario.

## V. VALIDACIÓN DE CALIDAD (IEEE 1012)

| ID_Prueba | US-ID | Input_Data | Expected_Outcome |
|-----------|-------|------------|------------------|
| T-001 | US-002 | `POST /registros` (Contratista) | HTTP 201 Created + Registro en DB |
| T-002 | US-003 | `POST /auditorias` (Admin) | HTTP 200 OK + Estado Actualizado |
| T-003 | US-004 | `POST /solicitudes/reapertura` | HTTP 201 + Notificación simulada |
